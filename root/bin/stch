#!/bin/sh
stch() {
# -e add escapes to $() -e add escapes to `, -e replace {{>}} with a file local to script execution, -e replace {{!}} commands
val=$(eval "cat << EOF_\$PPID
$(set -e; sed -e 's:{{>\s*\(.*\)\s*}}:{{!cat \1 | stch}}:g' -e 's:$(.*):\\&:g' -e 's:`:\\`:g' -e 's:{{\!\s*\(.*\)\s*}}:$(\1):g')
EOF_\$PPID")
[ "$val" ] && printf "%s\n" "$val"
}

stch
